(function(e,t,n,r){"use strict";function i(e,t){if(typeof t!=="object")t=t();Object.keys(t).forEach(function(n){e[n]=t[n]});return e}function s(e){return{from:function(t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;return{extend:function(n){i(e.prototype,typeof n!=="object"?n(t.prototype):n)}}}}}function o(e,t){return t(e)}function u(t){function nt(){if(n)Y.on("versionchange",function(t){Y.close();if(t.newVersion){e.location.reload(true)}})}function rt(e){this._cfg={version:e,dbschema:null,schemaUpgrade:null,contentUpgrade:null}}function it(e,t,n){if(e==0){Object.keys(R).forEach(function(e){ut(t,e,R[e].primKey,R[e].indexes)});var r=Y._createTransaction(Q,z,R);r.idbtrans=t;r.active=true;r.idbtrans.onerror=D(n,["populating database"]);Y.on("populate").fire(r)}else{var i=[];R=Y._dbSchema=null;var s=U.filter(function(t){return t._cfg.version>e});s.forEach(function(e){var r=R;var s=e._cfg.dbschema;R=Y._dbSchema=s;if(!r){i.push(function(e,t){at(s,e);t()})}else{var u=st(r,s);u.add.forEach(function(e){i.push(function(t,n){ut(t,e[0],e[1].primKey,e[1].indexes)});cb()});u.change.forEach(function(e){if(e.recreate){if(Ct()){if(!G||!G[e.name]){G=G||{__num:0};++G.__num;G[e.name]=[];Et(t.objectStore(e.name).openCursor(),null,function(t){G[e.name].push(t)},function(){if(--G.__num==0){t.abort();Y.open()}})}}i.push(function(t,n){lt(t,e.name,e.def.primKey,e.def.indexes,n)})}else{i.push(function(t,n){var r=t.objectStore(e.name);e.add.forEach(function(e){ft(r,e)});e.change.forEach(function(e){r.deleteIndex(e.name);ft(r,e)});e.del.forEach(function(e){r.deleteIndex(e)});n()})}});if(s._cfg.contentUpgrade){i.push(function(t,r){var i=Y._createTransaction(Q,[].slice.call(t.db.objectStoreNames,0),s);i.idbtrans=t;i.active=true;var u=0;i._promise=o(i._promise,function(e){return function(t,n,i){function s(e){return function(){e.apply(this,arguments);if(--u==0)r()}}++u;return e.call(this,t,function(e,t,r){arguments[0]=s(e);arguments[1]=s(t);n.apply(this,arguments)},i)}});t.onerror=D(n,["running upgrader function for version",e._cfg.version]);s._cfg.contentUpgrade(i);if(u===0)r()})}if(u.del.length){if(!Ct()){i.push(function(e,t){u.del.forEach(function(t){e.db.deleteObjectStore(t)});t()})}}}});var u=function(){if(i.length)i.shift()(t,u);else at(R,t)};if(G&&G.__num>0)return;u()}}function st(e,t){var n={del:[],add:[],change:[]};for(var r in e){if(!t[r])n.del.push(r)}for(var r in t){var i=e[r],s=t[r];if(!i)n.add.push([r,s]);else{var o={name:r,def:t[r],recreate:false,del:[],add:[],change:[]};if(i.primKey.src!=s.primKey.src){o.recreate=true;n.change.push(o)}else{var u=i.indexes.reduce(function(e,t){e[t.name]=t;return e},{});var a=s.indexes.reduce(function(e,t){e[t.name]=t;return e},{});for(var f in u){if(!a[f])o.del.push(f)}for(var f in a){var l=u[f],c=a[f];if(!l)o.add.push(c);else if(l.src!=c.src)o.change.push(c)}if(o.recreate||o.del.length>0||o.add.length>0||o.change.length>0){n.change.push(o)}}}}return n}function ot(e,t,n){Et(e.openCursor(),null,function(e){t.add(e)},n)}function ut(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});r.forEach(function(e){ft(i,e)});return i}function at(e,t){Object.keys(e).forEach(function(n){if(!t.db.objectStoreNames.contains(n)){ut(t,n,e[n].primKey,e[n].indexes)}})}function ft(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function lt(e,t,n,r,i){if(G){var s=ut(e,t,n,r);G[t].forEach(function(e){s.add(e)});delete G[t];if(Object.keys(G).length==0)G=null;i()}else{var o=ut(e,"_temp-"+t,n,[]);ot(e.objectStore(t),o,function(){e.db.deleteObjectStore(t);var s=ut(e,t,n,r);ot(o,s,function(){e.db.deleteObjectStore("_temp-"+t);i()})})}}function ct(e,t,n,r){this.name=e;this.schema=n;this.hook=W[e]?W[e].hook:b(null,{creating:[p,f],reading:[c,l],updating:[d,f],deleting:[g,f]});this._tpf=t;this._collClass=r||vt}function ht(e,t,n,r){ct.call(this,e,t,n,r||mt)}function pt(e,t,n){function i(e,t,n,i){return r._promise(e,n,i)}var r=this;this.mode=e;this.storeNames=t;this.idbtrans=null;this.on=b(this,["complete","error"],"abort");this._reculock=0;this._blockedFuncs=[];this._psd=null;this.active=false;this._dbschema=n;this._tpf=i;this.tables={};for(var s=t.length-1;s!==-1;--s){var o=t[s];var u=Y._tableFactory(e,n[o],i);this.tables[o]=u;if(!this[o])this[o]=u}}function dt(e,t,n){this._ctx={table:e,index:t===":id"?null:t,collClass:e._collClass,or:n}}function vt(e,t){var n=e._ctx;this._ctx={table:n.table,index:n.index,range:t,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:Infinity,error:null,or:n.or}}function mt(){vt.apply(this,arguments)}function gt(e,t){return e._cfg.version-t._cfg.version}function yt(){return U.sort(gt).reduce(function(e,t){return t._cfg.dbschema?t:e})._cfg.dbschema}function bt(e,t,n,r,i,s){n.forEach(function(n){if(!e[n]){var o=Y._tableFactory(r,i[n],t);if(s){Object.defineProperty(e,n,{configurable:true,enumerable:true,get:function(){if(a.PSD&&a.PSD.prohibitDB){throw new q("Dont call db."+n+" directly. Use tables from your db.transaction() callback instead, or use db.table(tableName) to explicitely show you know what you're doing.");return{A_NON_TRANSACTIONAL_TABLE_ACCESS_IN_TRANSCATION_SCOPE:1}}return o}})}else{e[n]=o}}})}function wt(e){e.forEach(function(e){for(var t in e){if(e[t]instanceof ct)delete e[t]}})}function Et(e,t,n,r,i,s){s=s||l;if(!e.onerror)e.onerror=D(i);if(t){e.onsuccess=x(function(u){var a=e.result;if(a){var f=function(){a.continue()};if(t(a,function(e){f=e},r,i))n(s(a.value),a,function(e){f=e});f()}else{r()}},i)}else{e.onsuccess=x(function(i){var o=e.result;if(o){var u=function(){o.continue()};n(s(o.value),o,function(e){u=e});u()}else{r()}},i)}}function St(e){var t=[];e.split(",").forEach(function(e){e=e.trim();var n=e.replace("&","").replace("++","").replace("*","");var r=n.indexOf("[")!==0?n:e.substring(1,e.indexOf("]")).split("+");t.push(new H(n,r||null,e.indexOf("&")!=-1,e.indexOf("*")!=-1,e.indexOf("++")!=-1,Array.isArray(r),r.indexOf(".")!=-1))});return t}function xt(e,t){return e<t?-1:e>t?1:0}function Tt(e,t){return e<t?1:e>t?-1:0}function Nt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function Ct(){return navigator.userAgent.indexOf("Trident / 7.0; rv: 11.0")>=0||navigator.userAgent.indexOf("MSIE")>=0}function kt(){Y.verno=X.version/10;Y._dbSchema=R={};z=[].slice.call(X.objectStoreNames,0);if(z.length==0)return;var e=X.transaction(z,"readonly");z.forEach(function(t){var n=e.objectStore(t);var r=new H(n.keyPath,n.keyPath||"",false,false,!!n.autoIncrement,false,n.keyPath&&n.keyPath.indexOf(".")!=-1);var i=[];for(var s=0;s<n.indexNames.length;++s){var o=n.index(n.indexNames[s]);var u=new H(o.name,o.keyPath,!!o.unique,!!o.multiEntry,false,typeof o.keyPath!=="string",o.keyPath.indexOf(".")!=-1);i.push(u)}R[t]=new B(t,r,i,{})});bt(W,Y._transPromiseFactory,Object.keys(R),Q,R)}var h=u.dependencies;var v=h.indexedDB,w=h.IDBKeyRange,O=h.IDBTransaction;var F=h.DOMError,I=h.TypeError,q=h.Error;var R=this._dbSchema={};var U=[];var z=[];var W={};var X=null;var V=true;var $=null;var J=false;var K="readonly",Q="readwrite";var G;var Y=this;var Z=[];var et=function(){function e(){}var t=new e;try{t.__proto__=Object.prototype;return!(t instanceof e)}catch(n){return false}}();var tt=false;this.version=function(e){if(X)throw new q("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=U.filter(function(t){return t._cfg.version==e})[0];if(t)return t;t=new rt(e);U.push(t);return t};i(rt.prototype,{stores:function(e){var t=this._cfg.dbschema=this._cfg.dbschema||{};this._parseStoresSpec(e,t);var n=yt();if(R!=n){R=Y._dbSchema=n;wt([W,Y]);bt(W,Y._transPromiseFactory,Object.keys(n),Q,n);bt(Y,Y._transPromiseFactory,Object.keys(n),Q,n,true)}z=Object.keys(n);return this},upgrade:function(e){var t=this;S(function(){e(Y._createTransaction(Q,Object.keys(t._cfg.dbschema),t._cfg.dbschema))});this._cfg.contentUpgrade=e;return this},_parseStoresSpec:function(e,t){Object.keys(e).forEach(function(n){var r={};var i=St(e[n]);var s=i.shift();if(s.multi)throw new q("Primary key cannot be multi-valued");if(s.keyPath&&s.auto)N(r,s.keyPath,0);i.forEach(function(e){if(e.auto)throw new q("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new q("Index must have a name and cannot be an empty string");N(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")});t[n]=new B(n,s,i,r)})}});this._allTables=W;this._tableFactory=function(t,n,r){if(t===K)return new ct(n.name,r,n,vt);else return new ht(n.name,r,n)};this._createTransaction=function(e,t,n){return new pt(e,t,n)};this._transPromiseFactory=function(t,n,r){if(V&&(!a.PSD||!a.PSD.letThrough)){return new a(function(e,i){Z.push({resume:function(){Y._transPromiseFactory(t,n,r).then(e,i)}})})}else{var i=Y._createTransaction(t,n,R);return i._promise(t,function(e,t){r(function(t){i.complete(function(){e(t)})},t,i)})}};this._whenReady=function(e){if(V&&(!a.PSD||!a.PSD.letThrough)){return new a(function(t,n){S(function(){new a(function(){e(t,n)})});Z.push({resume:function(){new a(function(){e(t,n)})}})})}return new a(e)},this.verno=0;this.open=function(){return new a(function(e,n){function r(e){J=false;$=e;V=false;n($);Z.forEach(function(e){e.resume()});Z=[]}if(X||J)throw new q("Database already opened or being opened");try{$=null;J=true;if(U.length==0){tt=true}else{if(!U[0]._cfg.dbschema)throw new q("No schema specified. Need to call dbInstance.version(ver).stores(schema) on at least the lowest version.");U.sort(gt).reduce(function(e,t){if(!t._cfg.dbschema)t._cfg.dbschema=e._cfg.dbschema;return t})}if(!v)throw new q("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");var i=false;var s=tt?v.open(t):v.open(t,Y.verno*10);s.onerror=_(r);s.onblocked=Y.on("blocked").fire;s.onupgradeneeded=function(e){if(tt&&!Y._allowEmptyDB){s.onerror=function(e){e.preventDefault()};s.transaction.abort();s.result.close();var n=v.deleteDatabase(t);n.onsuccess=n.onerror=function(){r(new q("Database '"+t+"' doesnt exist"))}}else{if(e.oldVersion==0)i=true;s.transaction.onerror=_(r);it(e.oldVersion/10,s.transaction,r)}};s.onsuccess=function(n){function f(){V=false;Z.forEach(function(e){e.resume()});Z=[];e()}J=false;X=s.result;if(tt)kt();X.onversionchange=Y.on("versionchange").fire;if(i){P(function(e){return e.push(t)})}var o=a.psd();a.PSD.letThrough=true;try{var u=Y.on.ready.fire();if(u&&typeof u.then=="function"){u.then(f,function(e){X.close();X=null;r(e)})}else{E(f)}}catch(n){r(n)}finally{a.PSD=o}}}catch(o){r(o)}})};this.close=function(){if(X){X.close();X=null;V=true;$=null}};this.delete=function(){return new a(function(e,n){function r(){Y.close();var r=v.deleteDatabase(t);r.onsuccess=function(){P(function(e){var n=e.indexOf(t);if(n>=0)return e.splice(n,1)});e()};r.onerror=D(n,["deleting",t]);r.onblocked=function(){Y.on("blocked").fire()}}if(J){Z.push({resume:r})}else{r()}})};this.backendDB=function(){return X};this.isOpen=function(){return X!==null};this.hasFailed=function(){return $!==null};this.vip=function(e){var t=a.psd();try{a.PSD.letThrough=true;return e()}finally{a.PSD=t}},this.name=t;Object.defineProperty(this,"tables",{get:function(){return Object.keys(W).map(function(e){return W[e]})}});this.on=b(this,"error","populate","blocked",{ready:[y,f],versionchange:[m,f]});S(function(){Y.on("populate").fire(Y._createTransaction(Q,z,R));Y.on("error").fire(new q)});this.transaction=function(e,t,n){t=[].slice.call(arguments,1,arguments.length-1);n=arguments[arguments.length-1];return Y._whenReady(function(r,i){var s=a.psd();try{a.PSD.prohibitDB=true;var o=Array.isArray(t[0])?t.reduce(function(e,t){return e.concat(t)}):t;var u=o.map(function(e){if(typeof e=="string"){if(!R[e]){throw new q("Invalid table name: "+e);return{INVALID_TABLE_NAME:1}}return e}else{if(!(e instanceof ct)){throw new I("Invalid type. Arguments following mode must be instances of Table or String");return{IVALID_TYPE:1}}return e.name}});if(e=="r"||e==K)e=K;else if(e=="rw"||e==Q)e=Q;else throw new q("Invalid transaction mode");var f=Y._createTransaction(e,u,R);var l=u.map(function(e){return f.tables[e]});l.push(f);var c;f.complete(function(){r(c)});f.error(function(e){var t=i(e);if(!t)Y.on("error").fire(e)});try{c=n.apply(f,l)}catch(h){f.abort();E(function(){if(!i(h))Y.on("error").fire(h)})}}finally{a.PSD=s}})};this.table=function(e){if(!tt&&!W.hasOwnProperty(e)){throw new q("Table does not exist");return{AN_UNKNOWN_TABLE_NAME_WAS_SPECIFIED:1}}return W[e]};i(ct.prototype,function(){return{_trans:function(t,n,r){return this._tpf(t,[this.name],n,r)},_idbstore:function(t,n,r){var i=this;return this._tpf(t,[this.name],function(e,t,r){n(e,t,r.idbtrans.objectStore(i.name),r)},r)},get:function(e,t){var n=this;S(function(){t(n.schema.instanceTemplate)});return this._idbstore(K,function(t,r,i){var s=i.get(e);s.onerror=D(r,["getting",e,"from",n.name]);s.onsuccess=function(){t(n.hook.reading.fire(s.result))}}).then(t)},where:function(e){return new dt(this,e)},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){var t=this;S(function(){e(t.schema.instanceTemplate)});return this._idbstore(K,function(n,r,i){var s=i.openCursor();s.onerror=D(r,["calling","Table.each()","on",t.name]);Et(s,null,e,n,r,t.hook.reading.fire)})},toArray:function(e){var t=this;S(function(){e([t.schema.instanceTemplate])});return this._idbstore(K,function(e,n,r){var i=[];var s=r.openCursor();s.onerror=D(n,["calling","Table.toArray()","on",t.name]);Et(s,null,function(e){i.push(e)},function(){e(i)},n,t.hook.reading.fire)}).then(e)},orderBy:function(e){return new this._collClass(new dt(this,e))},toCollection:function(){return new this._collClass(new dt(this))},mapToClass:function(e,t){if(this.schema.mappedClass)throw new q("Table already mapped");this.schema.mappedClass=e;var n=Object.create(e.prototype);if(this.schema.primKey.keyPath){N(n,this.schema.primKey.keyPath,this.schema.primKey.auto?0:"");C(e.prototype,this.schema.primKey.keyPath)}if(t){M(n,t)}this.schema.instanceTemplate=n;this.hook("reading",et?function(n){if(!n)return n;n.__proto__=e.prototype;return n}:function(n){if(!n)return n;var r=Object.create(e.prototype);for(var i in n)if(n.hasOwnProperty(i))r[i]=n[i];return r});return e},defineClass:function(e){return this.mapToClass(u.defineClass(e),e)}}});s(ht).from(ct).extend(function(){return{add:function(e,t){var n=this,i=this.hook.creating.fire;return this._idbstore(Q,function(s,o,u,a){var l={};if(i!==f){var c=t||(u.keyPath?T(e,u.keyPath):r);var h=i.call(l,c,e,a);if(c===r&&h!==r){if(u.keyPath)N(e,u.keyPath,h);else t=h}}var p=t?u.add(e,t):u.add(e);p.onerror=D(function(e){if(l.onerror)l.onerror(e);return o(e)},["adding",e,"into",n.name]);p.onsuccess=function(t){var n=u.keyPath;if(n)N(e,n,t.target.result);if(l.onsuccess)l.onsuccess(t.target.result);s(p.result)}})},put:function(e,t){var n=this,i=this.hook.creating.fire,s=this.hook.updating.fire;if(i!==f||s!==f){return this._trans(Q,function(i,s,o){var u=t||n.schema.primKey.keyPath&&T(e,n.schema.primKey.keyPath);if(u===r){o.tables[n.name].add(e).then(i,s)}else{o._lock();e=L(e);o.tables[n.name].where(":id").equals(u).modify(function(t){this.value=e}).then(function(r){if(r===0){return o.tables[n.name].add(e,t)}else{return u}}).finally(function(){o._unlock()}).then(i,s)}})}else{return this._idbstore(Q,function(r,i,s){var o=t?s.put(e,t):s.put(e);o.onerror=D(i,["putting",e,"into",n.name]);o.onsuccess=function(t){var n=s.keyPath;if(n)N(e,n,t.target.result);r(o.result)}})}},"delete":function(e){if(this.hook.deleting.subscribers.length){return this.where(":id").equals(e).delete()}else{return this._idbstore(Q,function(t,n,r){var i=r.delete(e);i.onerror=D(n,["deleting",e,"from",r.name]);i.onsuccess=function(e){t(i.result)}})}},clear:function(){if(this.hook.deleting.subscribers.length){this.toCollection().delete()}else{return this._idbstore(Q,function(e,t,n){var r=n.clear();r.onerror=D(t,["clearing",n.name]);r.onsuccess=function(t){e(r.result)}})}},update:function(e,t){if(typeof t!=="object"||Array.isArray(t))throw new q("db.update(keyOrObject, modifications). modifications must be an object.");if(typeof e==="object"&&!Array.isArray(e)){Object.keys(t).forEach(function(n){N(e,n,t[n])});var n=T(e,this.schema.primKey.keyPath);if(n===r)a.reject(new q("Object does not contain its primary key"));return this.where(":id").equals(n).modify(t)}else{return this.where(":id").equals(e).modify(t)}}}});i(pt.prototype,{_lock:function(){++this._reculock;if(this._reculock===1)this._psd=a.PSD&&a.PSD.constructor;return this},_unlock:function(){if(--this._reculock===0){this._psd=null;while(this._blockedFuncs.length>0&&!this._locked()){var e=this._blockedFuncs.shift();try{e()}catch(t){}}}return this},_locked:function(){return this._reculock&&(!this._psd||!(a.PSD instanceof this._psd))},_promise:function(e,t,n){var r=this;if(!this._locked()){var i=new a(function(i,s){if(!r.idbtrans&&e){if(!X)throw $;var o=r.idbtrans=X.transaction(r.storeNames,r.mode);r.active=true;o.onerror=function(e){r.on("error").fire(e&&e.target.error);e.preventDefault();r.abort()};o.onabort=function(e){r.active=false;r.on("abort").fire(e)};o.oncomplete=function(e){r.active=false;r.on("complete").fire(e)}}if(n)r._lock();t(i,s,r)});if(n)i.finally(function(){r._unlock()});i.onuncatched=function(e){r.on("error").fire(e);r.abort()};return i}else{return new a(function(i,s){r._blockedFuncs.push(function(){r._promise(e,t,n).then(i,s)})})}},complete:function(e){return this.on("complete",e)},error:function(e){return this.on("error",e)},abort:function(){if(this.idbtrans&&this.active)try{this.active=false;this.idbtrans.abort()}catch(e){}},table:function(e){if(!this.tables.hasOwnProperty(e)){throw new q("Table does not exist");return{AN_UNKNOWN_TABLE_NAME_WAS_SPECIFIED:1}}return this.tables[e]}});i(dt.prototype,function(){function e(e,t){try{throw t}catch(n){e._ctx.error=n}return e}function t(e){return Array.prototype.slice.call(Array.isArray(e[0])?e[0]:e,0).sort(xt)}function n(e){return e==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function r(e){return e==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function i(e,t,n,r,i,s){var o=Math.min(e.length,r.length);var u=-1;for(var a=0;a<o;++a){var f=t[a];if(f!==r[a]){if(i(e[a],n[a])<0)return e.substr(0,a)+n[a]+n.substr(a+1);if(i(e[a],r[a])<0)return e.substr(0,a)+r[a]+n.substr(a+1);if(u>=0)return e.substr(0,u)+t[u]+n.substr(u+1);return null}if(i(e[a],f)<0)u=a}if(o<r.length&&s==="next")return e+n.substr(e.length);if(o<e.length&&s==="prev")return e.substr(0,n.length);return u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function s(e,t,s){function h(e){o=n(e);u=r(e);a=e==="next"?xt:Tt;f=o(s);l=u(s);c=e}var o,u,a,f,l,c;h("next");e._ondirectionchange=function(e){h(e)};e._addAlgorithm(function(e,n,r){var s=e.key;if(typeof s!=="string")return false;var o=u(s);if(t(o,l)){n(function(){e.continue()});return true}else{var h=i(s,o,f,l,a,c);if(h){n(function(){e.continue(h)})}else{n(r)}return false}})}return{between:function(e,t,n,r){n=n!==false;r=r===true;if(e>t||e==t&&(n||r)&&!(n&&r))return(new this._ctx.collClass(this,w.only(e))).limit(0);return new this._ctx.collClass(this,w.bound(e,t,!n,!r))},equals:function(e){return new this._ctx.collClass(this,w.only(e))},above:function(e){return new this._ctx.collClass(this,w.lowerBound(e,true))},aboveOrEqual:function(e){return new this._ctx.collClass(this,w.lowerBound(e))},below:function(e){return new this._ctx.collClass(this,w.upperBound(e,true))},belowOrEqual:function(e){return new this._ctx.collClass(this,w.upperBound(e))},startsWith:function(t){if(typeof t!="string")return e(new this._ctx.collClass(this),new I("String expected"));return this.between(t,t+String.fromCharCode(65535),true,true)},startsWithIgnoreCase:function(t){if(typeof t!="string")return e(new this._ctx.collClass(this),new I("String expected"));if(t==="")return this.startsWith(t);var n=new this._ctx.collClass(this,w.bound(t.toUpperCase(),t.toLowerCase()+String.fromCharCode(65535)));s(n,function(e,t){return e.indexOf(t)===0},t);n._ondirectionchange=function(){e(n,new q("reverse() not supported with WhereClause.startsWithIgnoreCase()"))};return n},equalsIgnoreCase:function(t){if(typeof t!="string")return e(new this._ctx.collClass(this),new I("String expected"));var n=new this._ctx.collClass(this,w.bound(t.toUpperCase(),t.toLowerCase()));s(n,function(e,t){return e===t},t);return n},anyOf:function(e){var n=t(arguments);if(n.length===0)return(new this._ctx.collClass(this,w.only(""))).limit(0);var r=new this._ctx.collClass(this,w.bound(n[0],n[n.length-1]));var i=xt;r._ondirectionchange=function(e){i=e==="next"?xt:Tt;n.sort(i)};var s=0;r._addAlgorithm(function(e,t,r){var o=e.key;while(i(o,n[s])>0){++s;if(s===n.length){t(r);return false}}if(o===n[s]){t(function(){e.continue()});return true}else{t(function(){e.continue(n[s])});return false}});return r}}});i(vt.prototype,function(){function e(e,t){e.filter=Nt(e.filter,t)}function t(e,t){e.isMatch=Nt(e.isMatch,t)}function n(e,t){var n=e.index;return!n||t.keyPath&&n===t.keyPath?t:t.index(n)}function r(e,t){return n(e,t)[e.op](e.range||null,e.dir+e.unique)}function i(e,t,n,i,s){if(!e.or){Et(r(e,s),Nt(e.algorithm,e.filter),t,n,i,e.table.hook.reading.fire)}else{(function(){function l(){if(++f===2)n()}function c(e,n,r){if(!o||o(n,r,l,i)){var s=JSON.stringify(n.primaryKey);if(!u.hasOwnProperty(s)){u[s]=true;t(e,n,r)}}}var o=e.filter;var u={};var a=e.table.schema.primKey.keyPath;var f=0;e.or._iterate(c,l,i,s);Et(r(e,s),e.algorithm,c,l,i,e.table.hook.reading.fire)})()}}function s(e){return e.table.schema.instanceTemplate}return{_read:function(e,t){var n=this._ctx;if(n.error)return n.table._trans(null,function(t,r){r(n.error)});else return n.table._idbstore(K,e).then(t)},_write:function(e){var t=this._ctx;if(t.error)return t.table._trans(null,function(n,r){r(t.error)});else return t.table._idbstore(Q,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=Nt(t.algorithm,e)},_iterate:function(e,t,n,r){return i(this._ctx,e,t,n,r)},each:function(e){var t=this._ctx;S(function(){e(s(t))});return this._read(function(n,r,s){i(t,e,n,r,s)})},count:function(e){S(function(){e(0)});var t=this,r=this._ctx;if(r.filter||r.algorithm||r.or){var s=0;return this._read(function(e,t,n){i(r,function(){++s;return false},function(){e(s)},t,n)},e)}else{return this._read(function(e,i,s){var o=n(r,s);var u=r.range?o.count(r.range):o.count();u.onerror=D(i,["calling","count()","on",t.name]);u.onsuccess=function(t){e(Math.min(t.target.result,Math.max(0,r.limit-r.offset)))}},e)}},sortBy:function(e,t){function u(e,t){if(t)return u(e[r[t]],t-1);return e[i]}function f(e,t){var n=u(e,o),r=u(t,o);return n<r?-a:n>r?a:0}var n=this._ctx;S(function(){t([s(n)])});var r=e.split(".").reverse(),i=r[0],o=r.length-1;var a=this._ctx.dir==="next"?1:-1;return this.toArray(function(e){return e.sort(f)}).then(t)},toArray:function(e){var t=this._ctx;S(function(){e([s(t)])});return this._read(function(e,n,r){var s=[];i(t,function(e){s.push(e)},function(){e(s)},n,r)},e)},offset:function(t){var n=this._ctx;if(t<=0)return this;n.offset+=t;if(!n.or&&!n.algorithm&&!n.filter){e(n,function(n,r,i){if(t===0)return true;if(t===1){--t;return false}r(function(){n.advance(t);t=0});return false})}else{e(n,function(n,r,i){return--t<0})}return this},limit:function(t){this._ctx.limit=Math.min(this._ctx.limit,t);e(this._ctx,function(e,n,r){if(--t<=0)n(r);return t>=0});return this},until:function(t,n){var r=this._ctx;S(function(){t(s(r))});e(this._ctx,function(e,r,i){if(t(e.value)){r(i);return n}else{return true}});return this},first:function(e){var t=this;S(function(){e(s(t._ctx))});return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},and:function(n){var r=this;S(function(){n(s(r._ctx))});e(this._ctx,function(e){return n(e.value)});t(this._ctx,n);return this},or:function(e){return new dt(this._ctx.table,e,this)},reverse:function(){this._ctx.dir=this._ctx.dir=="prev"?"next":"prev";if(this._ondirectionchange)this._ondirectionchange(this._ctx.dir);return this},desc:function(){return this.reverse()},eachKey:function(e){var t=this;S(function(){e(s(t._ctx)[t._ctx.index])});this._ctx.op="openKeyCursor";return this.each(function(t,n){e(n.key,n)})},eachUniqueKey:function(e){this._ctx.unique="unique";return this.eachKey(e)},keys:function(e){S(function(){e([s(n)[t._ctx.index]])});var t=this,n=this._ctx;this._ctx.op="openKeyCursor";var r=[];return this.each(function(e,t){r.push(t.key)}).then(function(){return r}).then(e)},uniqueKeys:function(e){this._ctx.unique="unique";return this.keys(e)},firstKey:function(e){var t=this;return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t={};e(this._ctx,function(e){var n=JSON.stringify(e.primaryKey);var r=t.hasOwnProperty(n);t[n]=true;return!r});return this}}});s(mt).from(vt).extend({modify:function(e){var t=this,n=this._ctx,r=n.table.hook,s=r.updating.fire,o=r.deleting.fire;S(function(){if(typeof e==="function"){e.call({value:n.table.schema.instanceTemplate},n.table.schema.instanceTemplate)}});return this._write(function(r,u,a,l){function w(e,t,r){var i={primKey:t.primaryKey,value:e};if(c.call(i,e)!==false){var s=!i.hasOwnProperty("value");var o=s?t.delete():t.update(i.value);++v;o.onerror=D(function(e){y.push(e);b.push(i.primKey);if(i.onerror)i.onerror(e);return true},function(){return s?["deleting",e,"from",n.table.name]:["modifying",e,"on",n.table.name]});o.onsuccess=function(e){if(i.onsuccess)i.onsuccess(i.value);++m;S()}}}function E(e){if(e)y.push(e);return u(new j("Error modifying one or more objects",y,m,b))}function S(){if(g&&m+y.length===v){if(y.length>0)E();else r(m)}}var c;if(typeof e==="function"){if(s===f&&o===f){c=e}else{c=function(t){var n=L(t);if(e.call(this,t)===false)return false;if(!this.hasOwnProperty("value")){o.call(this,this.primKey,t,l)}else{var r=A(n,this.value);var i=s.call(this,r,this.primKey,n,l);if(i){t=this.value;Object.keys(i).forEach(function(e){N(t,e,i[e])})}}}}}else if(s===f){var h=Object.keys(e);var p=h.length;c=function(t){var n=false;for(var r=0;r<p;++r){var i=h[r],s=e[i];if(T(t,i)!==s){N(t,i,s);n=true}}return n}}else{var d=e;e=k(d);c=function(t){var n=false;var r=s.call(this,e,this.primKey,L(t),l);if(r)i(e,r);Object.keys(e).forEach(function(r){var i=e[r];if(T(t,r)!==i){N(t,r,e[r]);n=true}});if(r)e=k(d);return n}}var v=0;var m=0;var g=false;var y=[];var b=[];t._iterate(w,function(){g=true;S()},E,a)})},"delete":function(){return this.modify(function(){delete this.value})}});i(this,{Collection:vt,Table:ct,Transaction:pt,Version:rt,WhereClause:dt,WriteableCollection:mt,WriteableTable:ht});nt();u.addons.forEach(function(e){e(Y)})}function f(){}function l(e){return e}function c(e,t){if(e===l)return t;return function(n){return t(e(n))}}function h(e,t){return function(){e.apply(this,arguments);t.apply(this,arguments)}}function p(e,t){if(e===f)return t;return function(){var n=e.apply(this,arguments);if(n!==r)arguments[0]=n;var i=this.onsuccess,s=this.onerror;delete this.onsuccess;delete this.onerror;var o=t.apply(this,arguments);if(i)this.onsuccess=this.onsuccess?h(i,this.onsuccess):i;if(s)this.onerror=this.onerror?h(s,this.onerror):s;return o!==r?o:n}}function d(e,t){if(e===f)return t;return function(){var n=e.apply(this,arguments);if(n!==r)i(arguments[0],n);var s=this.onsuccess,o=this.onerror;delete this.onsuccess;delete this.onerror;var u=t.apply(this,arguments);if(s)this.onsuccess=this.onsuccess?h(s,this.onsuccess):s;if(o)this.onerror=this.onerror?h(o,this.onerror):o;return n===r?u===r?r:u:n.extend(u)}}function v(e,t){if(e===f)return t;return function(){if(e.apply(this,arguments)===false)return false;return t.apply(this,arguments)}}function m(e,t){if(e===f)return t;return function(){if(t.apply(this,arguments)===false)return false;return e.apply(this,arguments)}}function g(e,t){if(e===f)return t;return function(){e.apply(this,arguments);t.apply(this,arguments)}}function y(e,t){if(e===f)return t;return function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){var r=this,i=arguments;return n.then(function(){return t.apply(r,i)})}return t.apply(this,arguments)}}function b(t,n){function o(e,t,n){if(Array.isArray(e))return a(e);if(typeof e==="object")return u(e);if(!t)t=v;if(!n)n=f;var r={subscribers:[],fire:n,subscribe:function(e){r.subscribers.push(e);r.fire=t(r.fire,e)},unsubscribe:function(e){r.subscribers=r.subscribers.filter(function(t){return t!==e});r.fire=r.subscribers.reduce(t,n)}};i[e]=s[e]=r;return r}function u(t){Object.keys(t).forEach(function(n){var r=t[n];if(Array.isArray(r)){o(n,t[n][0],t[n][1])}else if(r==="asap"){var i=o(n,null,function(){var n=arguments;i.subscribers.forEach(function(t){E(function(){t.apply(e,n)})})});i.subscribe=function(e){if(i.subscribers.indexOf(e)===-1)i.subscribers.push(e)};i.unsubscribe=function(e){var t=i.subscribers.indexOf(e);if(t!==-1)i.subscribers.splice(t,1)}}else throw new Error("Invalid event config")})}function a(e){function n(){if(t)return false;t=true}var t=false;e.forEach(function(e){o(e).subscribe(n)})}var r=arguments;var i={};var s=function(e,n){if(n){i[e].subscribe(n);return t}else if(typeof e==="string"){return i[e]}};s.addEventType=o;for(var l=1,c=r.length;l<c;++l){o(r[l])}return s}function w(e){if(!e)throw new Error("Assertion failed")}function E(t){if(e.setImmediate)setImmediate(t);else setTimeout(t,0)}function S(e){var t=setTimeout(e,1e3);clearTimeout(t)}function x(e,t){return function(){try{e.apply(this,arguments)}catch(n){t(n)}}}function T(e,t){if(e.hasOwnProperty(t))return e[t];if(!t)return e;if(typeof t!=="string"){var n=[];for(var i=0,s=t.length;i<s;++i){var o=T(e,t[i]);if(o===r)return;n.push(o)}return o}var u=t.indexOf(".");if(u!==-1){var a=e[t.substr(0,u)];return a===r?r:T(a,t.substr(u+1))}return r}function N(e,t,n){if(!e||t===r)return;if(Array.isArray(t)){w(Array.isArray(n));for(var i=0,s=t.length;i<s;++i){N(e,t[i],n[i])}}else{var o=t.indexOf(".");if(o!==-1){var u=t.substr(0,o);var a=t.substr(o+1);if(a==="")if(n===r)delete e[u];else e[u]=n;else{var f=e[u];if(!f)f=e[u]={};N(f,a,n)}}else{if(n===r)delete e[t];else e[t]=n}}}function C(e,t){N(e,t,r)}function k(e){var t={};for(var n in e){if(e.hasOwnProperty(n))t[n]=e[n]}return t}function L(e){if(!e||typeof e!=="object")return e;var t;if(Array.isArray(e)){t=[];for(var n=0,r=e.length;n<r;++n){t.push(L(e[n]))}}else if(e instanceof Date){t=new Date;t.setTime(e.getTime())}else{t=e.constructor?Object.create(e.constructor.prototype):{};for(var i in e){if(e.hasOwnProperty(i)){t[i]=L(e[i])}}}return t}function A(e,t){var n={};for(var i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i))n[i]=r;else if(e[i]!==t[i]&&JSON.stringify(e[i])!=JSON.stringify(t[i]))n[i]=t[i]}for(var i in t)if(t.hasOwnProperty(i)&&!e.hasOwnProperty(i)){n[i]=t[i]}return n}function O(e){if(typeof e=="function"){return new e}else if(Array.isArray(e)){return[O(e[0])]}else if(e&&typeof e=="object"){var t={};M(t,e);return t}else{return e}}function M(e,t){Object.keys(t).forEach(function(n){var r=O(t[n]);e[n]=r})}function _(e){return function(t){return e(t&&t.target&&t.target.error)}}function D(e,t){return function(n){var r=n&&n.target.error||new Error;if(t){var i=" occured when "+t.map(function(e){switch(typeof e){case"function":return e();case"string":return e;default:return JSON.stringify(e)}}).join(" ");if(r.name){r.toString=function o(){return r.name+i+(r.message?". "+r.message:"")}}else{r=r+i}}var s=e(r);if(s){n.stopPropagation();n.preventDefault();return false}}}function P(e){var t;try{t=JSON.parse(localStorage.getItem("Dexie.DatabaseNames")||"[]")}catch(n){t=[]}if(e(t)){localStorage.setItem("Dexie.DatabaseNames",JSON.stringify(t))}}function H(e,t,n,r,i,s,o){this.name=e;this.keyPath=t;this.unique=n;this.multi=r;this.auto=i;this.compound=s;this.dotted=o;this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+t}function B(e,t,n,r){this.name=e;this.primKey=t||new H;this.indexes=n||[new H];this.instanceTemplate=r;this.mappedClass=null}function j(e,t,n,r){this.name="MultiModifyError";this.failures=t;this.failedKeys=r;this.successCount=n;this.message=t.join("\n")}var a=function(){function t(n){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof n!=="function")throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];this._catched=false;var r=this;var o=true;var u=t.psd();this._PSD=t.PSD;try{a(this,n,function(t){if(o)e(i,r,t);else i(r,t)},function(t){if(o){e(s,r,t);return false}else{return s(r,t)}})}finally{o=false;t.PSD=u}}function n(e){var t=this;if(this._state===null){this._deferreds.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null){return(t._state?e.resolve:e.reject)(t._value)}var i;try{i=n(t._value);if(!t._state&&(!i||typeof i.then!=="function"||i._state!==false))r(t)}catch(s){var o=e.reject(s);if(!o&&t.onuncatched){try{t.onuncatched(s)}catch(s){}}return}e.resolve(i)}function r(e){e._catched=true;if(e._parent)r(e._parent)}function i(e,n){var r=t.PSD;t.PSD=e._PSD;try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&(typeof n==="object"||typeof n==="function")){if(typeof n.then==="function"){a(e,function(e,t){n.then(e,t)},function(t){i(e,t)},function(t){s(e,t)});return}}e._state=true;e._value=n;o.call(e)}catch(u){s(u)}finally{t.PSD=r}}function s(e,n){var r=t.PSD;t.PSD=e._PSD;e._state=false;e._value=n;o.call(e);if(!e._catched&&e.onuncatched){try{e.onuncatched(e._value)}catch(i){}}t.PSD=r;return e._catched}function o(){for(var e=0,t=this._deferreds.length;e<t;e++){n.call(this,this._deferreds[e])}this._deferreds=[]}function u(e,t,n,r){this.onFulfilled=typeof e==="function"?e:null;this.onRejected=typeof t==="function"?t:null;this.resolve=n;this.reject=r}function a(e,t,n,r){var i=false;try{t(function(t){if(i)return;i=true;n(t)},function(n){if(i)return e._catched;i=true;return r(n)})}catch(s){if(i)return;return r(s)}}var e=typeof setImmediate==="undefined"?function(e,t,n,r){var i=arguments;setTimeout(function(){e.apply(this,[].slice.call(i,1))},0)}:function(e,t,n,r){setImmediate.apply(this,arguments)};t.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&Array.isArray(arguments[0])?arguments[0]:arguments);return new t(function(t,n){function i(s,o){try{if(o&&(typeof o==="object"||typeof o==="function")){var u=o.then;if(typeof u==="function"){u.call(o,function(e){i(s,e)},n);return}}e[s]=o;if(--r===0){t(e)}}catch(a){n(a)}}if(e.length===0)return t([]);var r=e.length;for(var s=0;s<e.length;s++){i(s,e[s])}})};t.prototype.then=function(e,r){var i=this;var s=new t(function(t,s){n.call(i,new u(e,r,t,s))});s._PSD=this._PSD;s.onuncatched=this.onuncatched;s._parent=this;return s};t.prototype["catch"]=function(e){if(arguments.length===1)return this.then(null,e);var n=arguments[0],r=arguments[1];return this.then(null,function(e){if(e instanceof n)return r(e);else return t.reject(e)})};t.prototype["finally"]=function(e){return this.then(function(t){e();return t},function(n){e();return t.reject(n)})};t.prototype.onuncatched=null;t.resolve=function(e){var n=new t(function(){});n._state=true;n._value=e};t.reject=function(e){var n=new t(function(){});n._state=false;n._value=e;return n};t.race=function(e){return new t(function(t,n){e.map(function(e){e.then(t,n)})})};t.PSD=null;t.psd=function(){function n(){}var e=t.PSD;if(e)n.prototype=e;t.PSD=new n;t.PSD.constructor=n;return e};return t}();s(j).from(Error);u.delete=function(e){var t=new u(e),n=t.delete();n.onblocked=function(e){t.on("blocked",e);return this};return n};u.getDatabaseNames=function(e){return(new a(function(e,t){if("webkitGetDatabaseNames"in indexedDB||"getDatabaseNames"in indexedDB){var n="getDatabaseNames"in indexedDB?indexedDB.getDatabaseNames():indexedDB.webkitGetDatabaseNames();n.onsuccess=function(t){e(t.target.result)};n.onerror=D(t)}else{P(function(t){t.contains=function(e){return this.indexOf(e)!==-1};e(t)})}})).then(e)};u.defineClass=function(e){function t(e){if(e)i(this,e)}M(t.prototype,e);return t};u.Promise=a;u.derive=s;u.extend=i;u.override=o;u.events=b;u.getByKeyPath=T;u.setByKeyPath=N;u.delByKeyPath=C;u.shallowClone=k;u.deepClone=L;u.addons=[];u.fakeAutoComplete=S;u.asap=E;u.MultiModifyError=j;u.IndexSpec=H;u.TableSchema=B;u.dependencies={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange,IDBTransaction:e.IDBTransaction||e.webkitIDBTransaction,Error:e.Error||String,SyntaxError:e.SyntaxError||String,TypeError:e.TypeError||String,DOMError:e.DOMError||String};u.version=.972;t("Dexie",u)}).apply(this,typeof module==="undefined"||typeof window!=="undefined"&&this==window?[window,function(e,t){window[e]=t},true]:[global,function(e,t){module.exports=t},false])