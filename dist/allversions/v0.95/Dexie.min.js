(function(e,t,n,r){"use strict";function i(e,t){Object.keys(t).forEach(function(n){e[n]=t[n]})}function s(e){return{from:function(t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;return{extend:function(t){i(e.prototype,typeof t==="function"?t():t)}}}}}function o(t){function P(){M=(new ot).pause();_.push(M);if(n)O.on("versionchange",function(t){if(t.newVersion&&t.newVersion>E){O.close();e.location.reload(true)}})}function H(e){this._cfg={version:e,tableSchema:null,schemaUpgrade:null,contentUpgrade:null}}function B(e,t,n){if(e==0){Object.keys(w).forEach(function(e){I(t,e,w[e].primKey,w[e].indexes)});var r=new ut(t);var i=new V(r,x);r.dexieTrans=i;i.on("error",function(e){n("Failed to populate database: "+e)});O.on("populate").fire(i)}else{var s=[];w=null;var o=S.filter(function(t){return t._cfg.version>e});o.forEach(function(e){var r=w;var i=e._cfg.tableSchema;w=i;if(!r){s.push(function(e,t){Object.keys(i).forEach(function(t){I(e,t,i[t].primKey,i[t].indexes)});t()})}else{var o=j(r,i);o.add.forEach(function(e){s.push(function(t,n){I(t,e[0],e[1].primKey,e[1].indexes)});cb()});o.change.forEach(function(e){if(e.recreate){if(dt()){if(!A||!A[e.name]){A=A||{__num:0};++A.__num;A[e.name]=[];nt(t.objectStore(e.name).openCursor(),null,function(t){A[e.name].push(t)},function(){if(--A.__num==0){t.abort();O.open()}})}}s.push(function(t,n){R(t,e.name,e.def.primKey,e.def.indexes,n)})}else{s.push(function(t,n){var r=t.objectStore(e.name);e.add.forEach(function(e){q(r,e)});e.change.forEach(function(e){r.deleteIndex(e.name);q(r,e)});e.del.forEach(function(e){r.deleteIndex(e)});n()})}});if(i._cfg.contentUpgrade){s.push(function(t,r){var s=new at(t);var o=new V(t,s,t.db.objectStoreNames);s.dexieTrans=o;s.onfinish=r;o.on("error",function(t){n("Failed running upgrader function for version "+e._cfg.version+": "+t)});i._cfg.contentUpgrade(o);if(s.uncompleteRequests==0)r()})}if(o.del.length){if(!dt()){s.push(function(e,t){o.del.forEach(function(t){e.db.deleteObjectStore(t)});t()})}}}});var u=function(){if(s.length)s.shift()(t,u)};if(A&&A.__num>0)return;u()}}function j(e,t){var n={del:[],add:[],change:[]};for(var r in e){if(!t[r])n.del.push(r)}for(var r in t){var i=e[r],s=t[r];if(!i)n.add.push([r,s]);else{var o={name:r,def:t[r],recreate:false,del:[],add:[],change:[]};if(i.primKey.src!=s.primKey.src){o.recreate=true;n.change.push(o)}else{var u=i.indexes.reduce(function(e,t){e[t.name]=t;return e},{});var a=s.indexes.reduce(function(e,t){e[t.name]=t;return e},{});for(var f in u){if(!a[f])o.del.push(f)}for(var f in a){var l=u[f],c=a[f];if(!l)o.add.push(c);else if(l.src!=c.src)o.change.push(c)}if(o.recreate||o.del.length>0||o.add.length>0||o.change.length>0){n.change.push(o)}}}}return n}function F(e,t,n){nt(e.openCursor(),null,function(e){t.add(e)},n)}function I(e,t,n,r){var i=e.db.createObjectStore(t,{keyPath:n.keyPath,autoIncrement:n.auto});r.forEach(function(e){q(i,e)});return i}function q(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function R(e,t,n,r,i){if(A){var s=I(e,t,n,r);A[t].forEach(function(e){s.add(e)});delete A[t];if(Object.keys(A).length==0)A=null;i()}else{var o=I(e,"_temp-"+t,n,[]);F(e.objectStore(t),o,function(){e.db.deleteObjectStore(t);var s=I(e,t,n,r);F(o,s,function(){e.db.deleteObjectStore("_temp-"+t);i()})})}}function U(e,t,n){this._name=e;this._tf=t;this._collClass=n||J}function z(e,t){U.call(this,e,t,K)}function W(e,t){z.call(this,e,t)}function X(e,t,n){this._ctx={tf:e,storeNames:t,tableClass:n||U};this.on=a(this,["complete","error"],"abort");this.complete=function(e){return this.on("complete",e)};this.error=function(e){return this.on("error",e)};e.dexieTrans=this;Y(this,e,n||U,t)}function V(e,t){X.call(this,e,t,z)}function $(e,t,n,r,i){this._ctx={tf:e,table:t,index:n,collClass:r||J,or:i}}function J(e,t){var n=e._ctx;this._ctx={tf:n.tf,table:n.table,index:n.index,range:t,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,offset:0,limit:Infinity,trans:null,oneshot:n.tf.oneshot,error:null,or:n.or}}function K(){J.apply(this,arguments)}function Q(e,t){return e._cfg.version-t._cfg.version}function G(){return S.sort(Q).reduce(function(e,t){return t._cfg.tableSchema?t:e})._cfg.tableSchema}function Y(e,t,n,r,i){for(var s=0,o=r.length;s<o;++s){var u=r[s];if(!e[u]){e[u]=new n(u,t);if(i)e[u]._instanceTemplate=i[u].instanceTemplate}}}function Z(e){for(var t in e){if(e[t]instanceof U)delete e[t]}}function et(e){var t=setTimeout(e,1e3);clearTimeout(t)}function tt(e){return O[e]._instanceTemplate}function nt(e,t,n,r,i,s){if(!e.onerror)e.onerror=pt(i,["calling openCursor() or openKeyCursor() on",self._name]);if(s){var o=n;if(D){n=function(e,t,n){if(e)e.__proto__=s;o(e,t,n)}}else{n=function(e,t,n){if(e){var r=Object.create(s);for(var i in e)r[i]=e[i];o(r,t)}else o(e,t,n)}}}if(t){e.onsuccess=c(function(s){var o=s.target.result;if(o){var u=function(){o.continue()};if(t(o,function(e){u=e},r,i))n(o.value,o,function(e){u=e});u()}else{r()}},i)}else{e.onsuccess=c(function(t){var i=t.target.result;if(i){var s=function(){i.continue()};n(i.value,i,function(e){s=e});s()}else{r()}},i)}}function rt(e){var t=[];e.split(",").forEach(function(e){if(!e)return;var n=e.replace("&","").replace("++","").replace("*","");var r=n.indexOf("[")!==0?n:e.substring(1,e.indexOf("]")).split("+");var i={name:n,keyPath:r||null,unique:e.indexOf("&")!=-1,multi:e.indexOf("*")!=-1,auto:e.indexOf("++")!=-1,compound:Array.isArray(r),dotted:r.indexOf(".")!=-1};i.src=(i.unique?"&":"")+(i.multi?"*":"")+(i.auto?"++":"")+i.keyPath;t.push(i)});return t}function it(e,t){return e<t?-1:e>t?1:0}function st(e,t){return e<t?1:e>t?-1:0}function ot(){this.waitingFns=[];this.paused=false}function ut(e,t){ot.call(this);this.dexieTrans=null;this.trans=e instanceof v?e:null;this.storeNames=this.trans?null:e;this.mode=t||null;this.inactive=false}function at(e,t){ut.call(this,e,t);this.uncompleteRequests=0;this.onfinish=null}function ft(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function lt(e){return function(t){return e(t&&t.target&&t.target.error)}}function ct(e,t){if(!t)return e;if(Array.isArray(t)){var n=[];for(var i=0,s=t.length;i<s;++i){var o=ct(e,t[i]);if(o===r)return;n.push(o)}return o}var u=t.indexOf(".");if(u!=-1){var a=e[t.substr(0,u)];return a===r?r:ct(a,t.substr(u+1))}return e[t]}function ht(e,t,n){if(!e||t===r)return;if(Array.isArray(t)){f(Array.isArray(n));for(var i=0,s=t.length;i<s;++i){ht(e,t[i],n[i])}}else{var o=t.indexOf(".");if(o!==-1){var u=t.substr(0,o);var a=t.substr(o+1);if(a==="")e[u]=n;else{var l=e[u];if(!l)l=e[u]={};ht(l,a,n)}}else{e[t]=n}}}function pt(e,t){return function(n){var r=n&&n.target.error||{};var i=Object.create(r);i.toString=function(){return r.toString()+" occurred when "+t.map(function(e){return typeof e==="function"?e():JSON.stringify(e)}).join(" ")};var s=e(i);if(s){n.stopPropagation();n.preventDefault();return false}}}function dt(){return navigator.userAgent.indexOf("Trident / 7.0; rv: 11.0")>=0||navigator.userAgent.indexOf("MSIE")>=0}var h=o.dependencies;var p=h.indexedDB,d=h.IDBKeyRange,v=h.IDBTransaction;var m=h.DOMError,g=h.TypeError,y=h.RangeError,b=h.Error;var w=null;var E=0;var S=[];var x=[];var T=null;var N=null;var C=false;var k="readonly",L="readwrite";var A;var O=this;var M;var _=[];var D=function(){function e(){}var t=new e;try{t.__proto__=Object.prototype;return!(t instanceof e)}catch(n){return false}}();this.version=function(e){if(T)throw new b("Cannot add version when database is open");E=Math.max(E,e);var t=new H(e);S.push(t);return t};i(H.prototype,{stores:function(e){var t=this._cfg.tableSchema=this._cfg.tableSchema||{};Object.keys(e).forEach(function(n){var r={};var i=rt(e[n]);var s=i.shift();if(s.multi)throw new b("Primary key cannot be multi-valued");if(s.keyPath&&s.auto)ht(r,s.keyPath,0);i.forEach(function(e){if(e.auto)throw new b("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new b("Index must have a name and cannot be an empty string");ht(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")});t[n]={primKey:s,indexes:i,instanceTemplate:r}});var n=G();if(w!=n){w=n;Z(O);Y(O,M,W,Object.keys(n),n)}x=Object.keys(n);return this},upgrade:function(e){var t=this;et(function(){e(new V(new ot,Object.keys(t._cfg.tableSchema)))});this._cfg.contentUpgrade=e;return this}});this.open=function(){return new u(function(e,n){function r(e){C=false;N=e;n(N);_.forEach(function(e){e.resume()})}if(T)throw new b("Database already open");try{N=null;C=true;if(S.length==0)throw new b("No versions specified. Need to call version(ver) method");if(!S[0]._cfg.tableSchema)throw new b("No schema specified. Need to call dbInstance.version(ver).stores(schema) on at least the lowest version.");S.sort(Q).reduce(function(e,t){if(!t._cfg.tableSchema)t._cfg.tableSchema=e._cfg.tableSchema;return t});if(!p)throw new b("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");var i=p.open(t,E*10);i.onerror=lt(r);i.onblocked=O.on("blocked").fire;i.onupgradeneeded=function(e){i.transaction.onerror=lt(n);B(e.oldVersion/10,i.transaction,n)};i.onsuccess=function(e){C=false;T=i.result;T.onversionchange=O.on("versionchange").fire;_.forEach(function(e){e.resume()});_=[]}}catch(s){r(s)}})};this._backendDB=function(){return T};this.close=function(){if(T){T.close();_.push(M.pause());T=null;N=null}};this.delete=function(){return new u(function(e,n){function r(){O.close();var r=p.deleteDatabase(t);r.onsuccess=e;r.onerror=n;r.onblocked=O.on("blocked").fire}if(C){_.push({resume:r})}else{r()}})};this.on=a(this,"error","populate","blocked","versionchange");et(function(){O.on("populate").fire(new V(new ot,x));O.on("error").fire(new b)});this.transaction=function(e,t,n){t=[].slice.call(arguments,1,arguments.length-1);n=arguments[arguments.length-1];return new u(function(r,i){var s=Array.isArray(t[0])?t.reduce(function(e,t){return e.concat(t)}):t;var o=s.map(function(e){if(typeof e=="string"){if(!w[e]){throw new b("Invalid table name: "+e);return{INVALID_TABLE_NAME:1}}return e}else{if(!(e instanceof U)){throw new g("Invalid type. Arguments following mode must be instances of Table or String");return{IVALID_TYPE:1}}return e._name}});var u,a;if(e==k||e=="r"){u=new ut(o,k);a=new X(u,o)}else if(e==L||e=="rw"){u=new ut(o,L);a=new V(u,o)}else{throw new y("Invalid mode. Only 'readonly'/'r' or 'readwrite'/'rw' are valid modes.")}u.dexieTrans=a;if(!T&&!N){_.push(u.pause())}var f=o.map(function(e){return a[e]});f.push(a);a.complete(r).error(function(e){var t=i(e);if(!t)O.on("error").fire(e)});try{n.apply(null,f)}catch(l){a.abort();i(l)}})};this.table=function(e){if(Object.keys(w).indexOf(e)==-1){throw new b("Table does not exist");return{AN_UNKNOWN_TABLE_NAME_WAS_SPECIFIED:1}}return new W(e,M)};s(U).from(o.Table).extend({get:function(e,t){var n=this;et(function(){t(tt(n._name))});return this._tf.createPromise(function(t,r){var i=n._tf.create(n._name).objectStore(n._name).get(e);i.onerror=pt(r,["getting",e,"from",n._name]);i.onsuccess=function(){var e=O[n._name]._mappedClass;if(e){var r=i.result;if(!r){t(r)}else if(D){r.__proto__=e.prototype;t(r)}else{var s=Object.create(e.prototype);for(var o in r)s[o]=r[o];t(s)}}else{t(i.result)}}}).then(t)},where:function(e){return new $(this._tf,this._name,e)},count:function(e){return(new J(new $(this._tf,this._name))).count(e)},limit:function(e){return(new this._collClass(new $(this._tf,this._name))).limit(e)},each:function(e){var t=this;et(function(){e(tt(t._name))});return this._tf.createPromise(function(n,r){var i=t._tf.create(t._name).objectStore(t._name).openCursor();i.onerror=pt(r,["calling","Table.each()","on",t._name]);nt(i,null,e,n,r,t._mappedClass&&t._mappedClass.prototype)})},toArray:function(e){var t=this;et(function(){e([tt(t._name)])});return this._tf.createPromise(function(e,n){var r=[];var i=t._tf.create(t._name).objectStore(t._name).openCursor();i.onerror=pt(n,["calling","Table.toArray()","on",t._name]);nt(i,null,function(e){r.push(e)},function(){e(r)},n,t._mappedClass&&t._mappedClass.prototype)}).then(e)},orderBy:function(e){return new this._collClass(new $(this._tf,this._name,e))}});s(z).from(U).extend({_wrop:function(e,t,n,r){var i=this,s=this._tf;return s.createPromise(function(o,u){var a=s.create(i._name,L);var f=a.objectStore(i._name);var l=f[e].apply(f,t||[]);l.onerror=pt(u,r);if(s.oneshot){a.oncomplete=function(){o(l.result)};if(n)l.onsuccess=n}else{if(n){l.onsuccess=function(){n.apply(this,arguments);o(l.result)}}else{l.onsuccess=function(){o(l.result)}}}})},put:function(e){return this._wrop("put",[e],function(t){var n=t.target.source.keyPath;if(n)ht(e,n,t.target.result)},["putting",e,"into",this._name])},add:function(e){return this._wrop("add",[e],function(t){var n=t.target.source.keyPath;if(n)ht(e,n,t.target.result)},["adding",e,"into",this._name])},"delete":function(e){return this._wrop("delete",[e],null,["deleting",e,"from",this._name])},clear:function(){return this._wrop("clear",[],null,["clearing",this._name])},where:function(e){return new $(this._tf,this._name,e,K)},modify:function(e){return(new K(new $(this._tf,this._name,null,K))).modify(e)}});s(W).from(z).extend(function(){function e(n){if(typeof n=="function"){return new n}else if(Array.isArray(n)){return[e(n[0])]}else if(typeof n=="object"){var r={};t(r,n);return r}else{return n}}function t(t,n){Object.keys(n).forEach(function(r){t[r]=e(n[r])})}return{mapToClass:function(e,n){var r=this._mappedClass=e;this._instanceTemplate=Object.create(r.prototype);if(n){t(this._instanceTemplate,n)}return e},defineClass:function(e){var n={};t(n,e);var r=w[this._name].primKey.keyPath;this._mappedClass=function(){for(var e in n)if(e!=r)this[e]=n[e]};this._instanceTemplate=n;return this._mappedClass}}});s(X).from(o.Transaction).extend({abort:function(){if(this._ctx.tf.trans&&!this._ctx.tf.inactive)try{this._ctx.tf.inactive=true;this._ctx.tf.trans.abort()}catch(e){}},table:function(e){if(Array.prototype.indexOf.call(this._ctx.storeNames,e)==-1)throw new b("Table does not exist");return new this._ctx.tableClass(e,this._ctx.tf)}});s(V).from(X);s($).from(o.WhereClause).extend(function(){function e(e,t){try{throw t}catch(n){e._ctx.error=n}return e}function t(e){return Array.prototype.slice.call(Array.isArray(e[0])?e[0]:e,0).sort()}function n(e){return e==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function r(e){return e==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function i(e,t,n,r,i,s){var o=Math.min(e.length,r.length);var u=-1;for(var a=0;a<o;++a){var f=t[a];if(f!==r[a]){if(i(e[a],n[a])<0)return e.substr(0,a)+n[a]+n.substr(a+1);if(i(e[a],r[a])<0)return e.substr(0,a)+r[a]+n.substr(a+1);if(u>=0)return e.substr(0,u)+t[u]+n.substr(u+1);return null}if(i(e[a],f)<0)u=a}if(o<r.length&&s==="next")return e+n.substr(e.length);if(o<e.length&&s==="prev")return e.substr(0,n.length);return u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function s(e,t,s){function h(e){o=n(e);u=r(e);a=e==="next"?it:st;f=o(s);l=u(s);c=e}var o,u,a,f,l,c;h("next");e._ondirectionchange=function(e){h(e)};e._addAlgorithm(function(e,n,r){var s=e.key;if(typeof s!=="string")return false;var o=u(s);if(t(o,l)){n(function(){e.continue()});return true}else{var h=i(s,o,f,l,a,c);if(h){n(function(){e.continue(h)})}else{n(r)}return false}})}return{between:function(e,t,n,r){n=n!==false;r=r===true;if(e>t||e==t&&(n||r)&&!(n&&r))return(new J(this,d.only(e))).limit(0);return new this._ctx.collClass(this,d.bound(e,t,!n,!r))},equals:function(e){return new this._ctx.collClass(this,d.only(e))},above:function(e){return new this._ctx.collClass(this,d.lowerBound(e,true))},aboveOrEqual:function(e){return new this._ctx.collClass(this,d.lowerBound(e))},below:function(e){return new this._ctx.collClass(this,d.upperBound(e,true))},belowOrEqual:function(e){return new this._ctx.collClass(this,d.upperBound(e))},startsWith:function(t){if(typeof t!="string")return e(new J(this),new g("String expected"));return this.between(t,t+String.fromCharCode(65535),true,true)},startsWithIgnoreCase:function(t){if(typeof t!="string")return e(new J(this),new g("String expected"));if(t==="")return this.startsWith(t);var n=new this._ctx.collClass(this);s(n,function(e,t){return e.indexOf(t)===0},t);n._ondirectionchange=function(){e(n,new b("desc() not supported with WhereClause.startsWithIgnoreCase()"))};return n},equalsIgnoreCase:function(t){if(typeof t!="string")return e(new J(this),new g("String expected"));var n=new this._ctx.collClass(this);s(n,function(e,t){return e===t},t);return n},anyOf:function(e){var n=t(arguments);var r=new this._ctx.collClass(this);var i=it;r._ondirectionchange=function(e){i=e==="next"?it:st;n.sort(i)};var s=0;r._addAlgorithm(function(e,t,r){var o=e.key;while(i(o,n[s])>0){++s;if(s===n.length){t(r);return false}}if(o===n[s]){t(function(){e.continue()});return true}else{t(function(){e.continue(n[s])});return false}});return r}}});s(J).from(o.Collection).extend(function(){function e(e,t){e.filter=ft(e.filter,t)}function t(e,t){e.trans=e.tf.create(e.table,t||k);var n=e.trans.objectStore(e.table),r=e.index;return!r||n.keyPath&&r===n.keyPath?n:n.index(r)}function n(e,n){return t(e,n)[e.op](e.range||null,e.dir+e.unique)}function r(e,t,n){function r(t,n){l(function(){n(e.error)})}if(e.error){return e.tf.createPromise(r)}else{return e.tf.createPromise(t).then(n)}}function i(e,t,r,i,s){var o=O[e.table]._mappedClass;if(!e.or){nt(n(e,s),ft(e.algorithm,e.filter),t,r,i,o&&o.prototype)}else{(function(){function c(){if(++l===2)r()}function h(e,n,r){if(!u||u(n,r,c,i)){var s=JSON.stringify(n.primaryKey);if(!a.hasOwnProperty(s)){a[s]=true;t(e,n,r)}}}var u=e.filter;var a={};var f=w[e.table].primKey.keyPath;var l=0;e.or._iterate(h,c,i,s);nt(n(e,s),e.algorithm,h,c,i,o&&o.prototype)})()}}return{_addAlgorithm:function(e){var t=this._ctx;t.algorithm=ft(t.algorithm,e)},_promise:function(e,t){return r(this._ctx,e,t)},_iterate:function(e,t,n,r){return i(this._ctx,e,t,n,r)},each:function(e){var t=this._ctx;et(function(){e(tt(t.table))});return r(t,function(n,r){i(t,e,n,r)})},count:function(e){et(function(){e(0)});var n=this,s=this._ctx;if(s.filter||s.algorithm||s.or){var o=0;return r(s,function(e,t){i(s,function(){++o;return false},function(){e(o)},t)},e)}else{return r(s,function(e,r){var i=t(s);var o=s.range?i.count(s.range):i.count();o.onerror=pt(r,["calling","count()","on",n._name]);o.onsuccess=function(t){e(Math.min(t.target.result,Math.max(0,s.limit-s.offset)))}},e)}},sortBy:function(e,t){function o(e,t){if(t)return o(e[r[t]],t-1);return e[i]}function a(e,t){var n=o(e,s),r=o(t,s);return n<r?-u:n>r?u:0}var n=this._ctx;et(function(){t([tt(n.table)])});var r=e.split(".").reverse(),i=r[0],s=r.length-1;var u=this._ctx.dir==="next"?1:-1;return this.toArray(function(e){return e.sort(a)}).then(t)},toArray:function(e){var t=this._ctx;et(function(){e([tt(t.table)])});return r(t,function(e,n){var r=[];i(t,function(e){r.push(e)},function(){e(r)},n)},e)},offset:function(t){var n=this._ctx;if(t<=0)return this;n.offset+=t;if(!n.or&&!n.algorithm&&!n.filter){e(n,function(n,r,i){if(t===0)return true;if(t===1){--t;return false}r(function(){n.advance(t);t=0});return false})}else{e(n,function(n,r,i){return--t<0})}return this},limit:function(t){this._ctx.limit=Math.min(this._ctx.limit,t);e(this._ctx,function(e,n,r){if(--t<=0)n(r);return t>=0});return this},first:function(e){var t=this;et(function(){e(tt(t._ctx.table))});return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.desc().first(e)},and:function(t){var n=this;et(function(){t(tt(n._ctx.table))});e(this._ctx,function(e){return t(e.value)});return this},or:function(e){return new $(this._ctx.tf,this._ctx.table,e,this.constructor,this)},desc:function(){this._ctx.dir=this._ctx.dir=="prev"?"next":"prev";if(this._ondirectionchange)this._ondirectionchange(this._ctx.dir);return this},eachKey:function(e){var t=this;et(function(){e(tt(t._ctx.table)[t._ctx.index])});this._ctx.op="openKeyCursor";return this.each(function(t,n){e(n.key,n)})},eachUniqueKey:function(e){this._ctx.unique="unique";return this.eachKey(e)},keys:function(e){et(function(){e([tt(n.table)[t._ctx.index]])});var t=this,n=this._ctx;this._ctx.op="openKeyCursor";var r=[];return this.each(function(e,t){r.push(t.key)}).then(function(){return r}).then(e)},uniqueKeys:function(e){this._ctx.unique="unique";return this.keys(e)},distinct:function(){var t={};e(this._ctx,function(e){var n=JSON.stringify(e.primaryKey);var r=t.hasOwnProperty(n);t[n]=true;return!r});return this}}});s(K).from(J).extend({modify:function(e){var t=this,n=this._ctx;return this._promise(function(r,i){function h(e,t,s){++a;if(c){s(function(){});return}u(e);var o=t.update(e);o.onerror=pt(function(e){var t=i(e);if(!t)c=true;if(t&&!n.oneshot)n.tf.resume();return t},function(){return["modifying",e,"on",n.table]});o.onsuccess=function(){++f;if(l&&f===a){n.tf.resume();r(f)}}}if(!n.oneshot)n.tf.pause();var s=Object.keys(e);var o=s.length;var u;if(typeof e==="function"){u=e}else{u=function(t){for(var n=0;n<o;++n){var r=s[n];ht(t,r,e[r])}}}var a=0;var f=0;var l=false;var c=false;if(n.oneshot){t._iterate(h,function(){},i,L);n.trans.oncomplete=function(){r(f)}}else{t._iterate(h,function(){l=true;if(f==a){n.tf.resume();r(f)}},i,L)}})},"delete":function(){var e=this,t=this._ctx;return this._promise(function(n,r){function s(e,n,s){++i;n.delete().onerror=pt(function(e){s(function(){});var n=r(e);if(n&&t.oneshot)t.tf.resume();return n},function(){return["deleting",e,"on",t.table]})}if(!t.oneshot)t.tf.pause();var i=0;if(t.oneshot){e._iterate(s,function(){},r,L);t.trans.oncomplete=function(){n(i)}}else{e._iterate(s,function(){t.tf.resume();n(i)},r,L)}})}});i(ot.prototype,{create:function(e,t){if(!T)throw N;return T.transaction(e,t||k)},oneshot:true,createPromise:function(e){return new u(e)},pause:function(){this.paused=true;this.createPromise=function(e){var t=this.constructor.prototype;var n=this;var r=function(t,r){var i=this,s=arguments;n.waitingFns.push(function(){try{e.apply(i,s)}catch(t){r(t)}})};return t.createPromise.call(this,r)};return this},resume:function(){this.paused=false;delete this.createPromise;while(this.waitingFns.length>0&&!this.paused){var e=this.waitingFns.shift();try{e()}catch(t){}}return this}});s(ut).from(ot).extend({oneshot:false,create:function(){if(this.trans)return this.trans;if(!T)throw N;var e=this;this.trans=T.transaction(this.storeNames,this.mode);this.trans.onerror=function(t){e.dexieTrans.on("error").fire(t&&t.target.error);t.preventDefault();e.dexieTrans.abort()};this.trans.onabort=this.dexieTrans.on("abort").fire;this.trans.oncomplete=this.dexieTrans.on("complete").fire;this.dexieTrans.on("abort",function(){e.inactive=true});this.dexieTrans.on("complete",function(){e.inactive=true});return this.trans},createPromise:function(e){var t=this;var n=ot;var r=n.prototype.createPromise.call(this,e);r.onuncatched=function(e){t.dexieTrans.on("error").fire(e);t.dexieTrans.abort()};return r}});s(at).from(ut).extend({createPromise:function(e){function n(e){return function(){e.apply(this,arguments);if(--t.uncompleteRequests==0&&t.onfinish)t.onfinish()}}var t=this;++t.uncompleteRequests;var r=ut;return r.prototype.createPromise.call(this,function(t,r){arguments[0]=n(t);arguments[1]=n(r);e.apply(this,arguments)})}});this._types={Collection:J,Promise:u,Table:U,Transaction:X,Version:H,WhereClause:$,WriteableCollection:K,WriteableTable:z,WriteableTransaction:V};P()}function a(e,t){function i(e){function t(e){for(var t=this.l.length-1;t>=0;--t){if(this.l[t](e)===false)return false}}r[e]={l:[],f:t,s:function(e){this.l.push(e)},u:function(e){this.l=this.l.filter(function(t){return t!==e})}};return t}function s(e,t){var n=i(e);var s=i(t);var o=new u(function(n,i){r[e].f=n;r[t].f=i});r[e].p=o;o.then(function(t){n.call(r[e],t)},function(e){s.call(r[t],e)})}var n=arguments;var r={};for(var o=1,a=n.length;o<a;++o){var f=n[o];if(typeof f=="string"){i(f)}else{s(f[0],f[1])}}var l=function(t,n){if(n){r[t].s(n);return e}else if(typeof t==="string"){return{fire:function(e){r[t].f(e)},unsubscribe:function(e){r[t].u(e)}}}else{var i=t[0],s=t[1];return{getPromise:function(){return r[i].p}}}};return l}function f(e){if(!e)throw new Error("Assertion failed")}function l(t){if(e.setImmediate)setImmediate(t);else setTimeout(t,0)}function c(e,t){return function(){try{e.apply(this,arguments)}catch(n){t(n)}}}var u=function(){function t(t){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof t!=="function")throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];this._catched=false;var n=this;var r=true;try{a(t,function(t){if(r)e(i,n,t);else i(n,t)},function(t){if(r){e(s,n,t);return false}else{return s(n,t)}})}finally{r=false}}function n(e){var t=this;if(this._state===null){this._deferreds.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null){(t._state?e.resolve:e.reject)(t._value);return}var i;try{i=n(t._value);if(!t._state)r(t)}catch(s){var o=e.reject(s);if(!o&&t.onuncatched){try{t.onuncatched(s)}catch(s){}}return}e.resolve(i)}function r(e){e._catched=true;if(e._parent)r(e._parent)}function i(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&(typeof t==="object"||typeof t==="function")){if(typeof t.then==="function"){a(function(e,n){t.then(e,n)},function(t){i(e,t)},function(t){s(e,t)});return}}e._state=true;e._value=t;o.call(e)}catch(n){s(n)}}function s(e,t){e._state=false;e._value=t;o.call(e);if(!e._catched&&e.onuncatched){try{e.onuncatched(e._value)}catch(n){}}return e._catched}function o(){for(var e=0,t=this._deferreds.length;e<t;e++){n.call(this,this._deferreds[e])}this._deferreds=null}function u(e,t,n,r){this.onFulfilled=typeof e==="function"?e:null;this.onRejected=typeof t==="function"?t:null;this.resolve=n;this.reject=r}function a(e,t,n){var r=false;try{e(function(n){if(r)return;r=true;t(n)},function(t){if(r)return;r=true;return n(t)})}catch(i){if(r)return;return n(i)}}var e=typeof setImmediate==="undefined"?function(e,t,n,r){var i=arguments;setTimeout(function(){e.apply(this,[].slice.call(i,1))},0)}:function(e,t,n,r){setImmediate.apply(this,arguments)};t.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&Array.isArray(arguments[0])?arguments[0]:arguments);return new t(function(t,n){function i(s,o){try{if(o&&(typeof o==="object"||typeof o==="function")){var u=o.then;if(typeof u==="function"){u.call(o,function(e){i(s,e)},n);return}}e[s]=o;if(--r===0){t(e)}}catch(a){n(a)}}if(e.length===0)return t([]);var r=e.length;for(var s=0;s<e.length;s++){i(s,e[s])}})};t.prototype.then=function(e,r){var i=this;var s=new t(function(t,s){n.call(i,new u(e,r,t,s))});s._parent=this;return s};t.prototype["catch"]=function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return this.then(null,function(e){if(e instanceof t)return n(e);else throw e})};t.prototype["finally"]=function(e){return this.then(e,e)};t.prototype.onuncatched=null;t.resolve=function(e){return new t(function(t){t(e)})};t.reject=function(e){return new t(function(t,n){n(e)})};t.race=function(e){return new t(function(t,n){e.map(function(e){e.then(t,n)})})};return t}();o.delete=function(e){var t=new o(e),n=t.delete();n.onblocked=function(e){t.on("blocked",e);return this};return n};o.Collection=function(){};o.Table=function(){};o.Transaction=function(){};o.WhereClause=function(){};o.Promise=u;o.derive=s;o.extend=i;o.events=a;o.dependencies={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange,IDBTransaction:e.IDBTransaction||e.webkitIDBTransaction,Error:e.Error||String,SyntaxError:e.SyntaxError||String,TypeError:e.TypeError||String,RangeError:e.RangeError||String,DOMError:e.DOMError||String};o.version=.95;t("Dexie",o)}).apply(this,typeof module==="undefined"||typeof window!=="undefined"&&this==window?[window,function(e,t){window[e]=t},true]:[global,function(e,t){module.exports=t},false])